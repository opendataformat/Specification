Generating Open Data Format with Stata
================

-   [Generating ODF from CSV](#generating-odf-from-csv)
-   [Generating ODF from dta](#generating-odf-from-enriched-dta)

Author: Xiaoyao Han, Tom Hartl, Claudia Saalbach, Knut Wenzig  
Affiliation: DIW Berlin  
Created: 2022-03-01  
Version: v1.0.0  
Last modified: 2024-08-12
Licence: This repository is issued under a CC by licence
(<https://creativecommons.org/licenses/by/4.0/>)

------------------------------------------------------------------------
This section demonstrates two ways to generate data files in the Open Data Format (ODF) using Stata. 
The first approach is to generate four CSV files following the specification of the internal Open Data Format. 
The second approach is to enrich a Stata dataset directly in Stata with the metadata in accordance with the ODF specification.


## Generating ODF from CSV

An easy way to generate data files in the Open Data Format is to go through
four CSV files in the Internal Open Data Format. The opendf package in Stata
offers a function to generate an ODF zip-file from the four CSVs.
The advantage using this approach is that CSV files containing data and 
metadata can be easily generated by any data provider who has structured 
metadata in a machine-readable format.

The requirements and structure of the CSV files for generating ODF and 
examples can be found on GitLab.

Once the four CSV files are provided the ODF can be generated using the 
`opendf csv2zip`-command from the opendf package.

## Generating ODF from enriched dta

A second approach is to enrich a Stata dataset (.dta) with metadata according to  
the ODF specification and in line with the internal specification of the opendf 
package for storing metadata.

Therefore, metadata has to be assigned to the labels, value labels and the 
characteristics of the dataframe and the variables.
The dataset metadata has to be stored to the characteristics of the dataset.
The dataset metadata includes the fields/characteristics `study`, `name`, 
`description_lang` for each language (lang) and `url`. Additionally, the labels 
have to be defined for each metadata language. 
The ODF allows multilingual labels and descriptions by using the *lang* suffix. 
This suffix holds the language code defined by the ISO 639-1 
(<https://de.wikipedia.org/wiki/Liste_der_ISO-639-1-Codes>). For example, if a 
description is specified in English and in German, there will be both a 
characteristic `description_en` and a characteristic `description_de`. 

The variable metadata includes the fields/characteristics `description_lang` for 
each language (lang), `type` (character or numeric), `url`. Additionally, the labels 
and value labels have to be defined for each metadata language.

Since the ODF specification allows for value labels for character variables,
but Stata does not, these value labels have to be stored to the characteristics.
Labelled values are stored to the characteristic `labelled_values` and each value 
is separated by `<;>`.
The labels for each language (lang) are stored in the characteristic `value_labels_lang`
and are equally separated by `<;>`. 
